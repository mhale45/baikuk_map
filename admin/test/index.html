<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë§¤ë¬¼ì¥ë¶€</title>
  <link rel="icon" type="image/png" href="https://sfinbtiqlfnaaarziixu.supabase.co/storage/v1/object/public/baikuk-images-open/pabicon-baikuk-simbol.png" />
  <link rel="preconnect" href="https://sfinbtiqlfnaaarziixu.supabase.co" crossorigin>
  <link rel="dns-prefetch" href="//sfinbtiqlfnaaarziixu.supabase.co">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .custom-scroll::-webkit-scrollbar {
      width: 20px;
      height: 20px;
    }
    .custom-scroll::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    .custom-scroll::-webkit-scrollbar-thumb {
      background-color: #c1c1c1;
      border-radius: 6px;
      border: 2px solid #f1f1f1;
    }
    .custom-scroll::-webkit-scrollbar-thumb:hover {
      background-color: #999;
    }
    th.resizable {
      position: relative;
    }
    .resize-handle {
      position: absolute;
      right: 0;
      top: 0;
      width: 6px;
      height: 100%;
      cursor: col-resize;
      z-index: 10;
    }
    th.resizing {
      cursor: col-resize;
    }
    .filter-popup {
      position: absolute;
      background: white;
      border: 1px solid #d1d5db; /* gray-300 */
      border-radius: 0.375rem; /* rounded-md */
      padding: 0.5rem;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      z-index: 50;
    }    
    .shadow-right {
      box-shadow: 8px 0 12px -4px rgba(0, 0, 0, 0.08);
    }
  </style>
  <script type="module">
    /***************************************************************
     * ğŸ” SUPABASE ì„¸ì…˜ ë””ë²„ê·¸ ì½˜ì†” (ì „ì²´ ë¡œì§ í™•ì¸ìš©)
     ***************************************************************/
    console.log("%c[DEBUG] Supabase ì„¸ì…˜ ë””ë²„ê·¸ ì‹œì‘", "color: white; background: black; padding: 4px;");

    // localStorage ì¶œë ¥
    console.log("[DEBUG] localStorage keys:", Object.keys(localStorage));
    console.log("[DEBUG] sb-auth-token:", localStorage.getItem("sb-sfinbtiqlfnaaarziixu-auth-token"));

    /***************************************************************
     * ğŸ” Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±
     ***************************************************************/
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const client = createClient(
      'https://sfinbtiqlfnaaarziixu.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNmaW5idGlxbGZuYWFhcnppaXh1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1MDkxNjEsImV4cCI6MjA2ODA4NTE2MX0.4-7vnIjbF-biWWuv9-vTxK9Y99gMm-vS6oaRMdRL5fA'
    );

    console.log("[DEBUG] client initialized:", {
      url: client.supabaseUrl,
      keyExists: !!client.supabaseKey
    });

    /***************************************************************
     * ğŸŸ¡ 1ë‹¨ê³„: getSession() â†’ ì¦‰ì‹œ í™•ì¸
     ***************************************************************/
    (async () => {
      console.log("%c[DEBUG] 1) getSession() í˜¸ì¶œ", "background: yellow; padding: 4px;");
      const r1 = await client.auth.getSession();
      console.log("[DEBUG] 1ì°¨ getSession ê²°ê³¼:", r1);

      /***************************************************************
       * ğŸ” ì„¸ì…˜ ì²´í¬ ë¡œì§ ë³¸ì²´
       ***************************************************************/
      const { data: { session } } = r1;

      if (!session) {
        console.warn("[DEBUG] ì„¸ì…˜ ì—†ìŒ â†’ ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ");

        window.__BLOCK_APP__ = true;

        const $screen = document.getElementById('auth-screen');
        const $email  = document.getElementById('auth-email');
        const $pw     = document.getElementById('auth-password');
        const $login  = document.getElementById('auth-login');
        const $close  = document.getElementById('auth-close');
        const $err    = document.getElementById('auth-error');

        $screen?.classList.remove('hidden');

        // ë¡œê·¸ì¸ í•¨ìˆ˜
        const doLogin = async () => {
          try {
            $login.disabled = true;
            $login.textContent = 'ë¡œê·¸ì¸ ì¤‘...';
            $err?.classList.add('hidden');

            const { error } = await client.auth.signInWithPassword({
              email: ($email?.value || '').trim(),
              password: ($pw?.value || '').trim()
            });
            if (error) throw error;

            // ì„¸ì…˜ ë“±ë¡ RPC
            try {
              await client.rpc('register_session', {
                device_label: (navigator.platform + ' ' + (navigator.vendor || '')).trim(),
                user_agent: navigator.userAgent
              });
            } catch (_) {}

            // ì„¸ì…˜ í—ˆìš© ì²´í¬ RPC
            let allowed = true;
            try {
              const { data } = await client.rpc('is_session_allowed');
              if (data === false) allowed = false;
            } catch (_) {}

            if (!allowed) {
              await client.auth.signOut();
              throw new Error('í—ˆìš©ëœ ê¸°ê¸° ìˆ˜ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.');
            }

            // ë¡œê·¸ì¸ ì„±ê³µ í›„ ì´ë™
            location.replace('https://baikuk-map.netlify.app/admin/listings/');

          } catch (e) {
            $err.textContent = e?.message || 'ë¡œê·¸ì¸ ì‹¤íŒ¨';
            $err.classList.remove('hidden');
            $login.disabled = false;
            $login.textContent = 'ë¡œê·¸ì¸';
          }
        };

        $login && ($login.onclick = doLogin);
        $close && ($close.onclick = () => location.replace('https://baikuk.com/map'));

        [$email, $pw].forEach(inp => {
          inp?.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') doLogin();
          });
        });

        // ì„¸ì…˜ ì—†ìŒ â†’ listings.js ì‹¤í–‰ ì°¨ë‹¨
        return;
      }

      /***************************************************************
       * ğŸŸ¢ ì„¸ì…˜ ìˆìŒ â†’ ì •ìƒ ë¡œê·¸ì¸ ìƒíƒœ
       ***************************************************************/
      console.log("%c[DEBUG] ë¡œê·¸ì¸ ì„¸ì…˜ í™•ì¸ë¨! â†’ __BLOCK_APP__ = false", "background: green; color: white; padding: 4px;");
      window.__BLOCK_APP__ = false;

    })().catch(err => {
      console.warn("[DEBUG] getSession ê²€ì‚¬ ì¤‘ ì˜¤ë¥˜:", err);
      window.__BLOCK_APP__ = true;
      document.getElementById('auth-screen')?.classList.remove('hidden');
    });

    /***************************************************************
     * ğŸ”µ 2ë‹¨ê³„: Supabase ì„¸ì…˜ ì´ë²¤íŠ¸ ê°ì§€
     ***************************************************************/
    client.auth.onAuthStateChange((evt, session) => {
      console.log(
        "%c[DEBUG] onAuthStateChange ì´ë²¤íŠ¸ ë°œìƒ â†’ " + evt,
        "background: cyan; padding: 4px;"
      );
      console.log("[DEBUG] session ê°’:", session);

      if (evt === 'SIGNED_IN') {
        console.log("%c[DEBUG] SIGNED_IN ê°ì§€ë¨", "background: green; color: white; padding: 4px;");
      }
      if (evt === 'SIGNED_OUT') {
        console.log("%c[DEBUG] SIGNED_OUT ê°ì§€ë¨", "background: red; color: white; padding: 4px;");
      }
    });

  </script>
 

  <script type="module" src="./listings.js"></script>
</head>
<body class="h-screen w-screen">
  <!-- ğŸ” ë¡œê·¸ì¸ ì „ì²´ í™”ë©´ -->
  <div id="auth-screen" class="fixed inset-0 z-[99999] hidden">
    <div class="w-full h-full flex items-center justify-center bg-gray-100">
      <div class="bg-white w-[22rem] rounded-xl shadow-xl p-6">
        <h2 class="text-xl font-bold text-center mb-4">ì§ì› ë¡œê·¸ì¸</h2>
        <input id="auth-email" type="email" placeholder="ì´ë©”ì¼"
               class="w-full border border-gray-300 rounded px-3 py-2 mb-2" />
        <input id="auth-password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸"
               class="w-full border border-gray-300 rounded px-3 py-2 mb-3" />
        <button id="auth-login"
                class="w-full bg-blue-600 text-white py-2 rounded font-semibold hover:bg-blue-700">
          ë¡œê·¸ì¸
        </button>
        <button id="auth-close"
                class="w-full mt-2 border border-gray-300 text-gray-600 py-2 rounded hover:bg-gray-50">
          ë‹«ê¸°
        </button>
        <div id="auth-error" class="text-red-600 text-sm mt-3 hidden"></div>
      </div>
    </div>
  </div>
  <div class="absolute top-0 left-0 z-[9998] bg-white w-[13rem] h-[60px] rounded-xl">
    <img src="https://sfinbtiqlfnaaarziixu.supabase.co/storage/v1/object/public/baikuk-images-open/logotype-baikuk.png"
        alt="ê¸€ì”¨ë¡œê³ "
        class="absolute h-11 w-auto cursor-pointer top-2 left-2 z-[9999]"
        onclick="location.reload()"/>
  </div>
  <div class="flex h-full">    
    <div class="w-[6%] pt-[5rem] shadow-right text-center bg-white">
      <a href="https://baikuk.com/map"><div class="text-lg font-extrabold px-2 py-1 rounded hover:bg-gray-200 cursor-pointer">ë°±ì–µì§€ë„</div></a>
      <a href="/admin/mmap/"><div class="text-lg font-extrabold px-2 py-1 rounded hover:bg-gray-200 cursor-pointer mb-5">ë°±ì–µì§€ë„</div></a>
      <a href="/admin/listings/"><div class="bg-gray-100 border-l-4 border-gray-500 text-lg font-extrabold px-2 py-1 rounded hover:bg-gray-200 cursor-pointer">ë§¤ë¬¼ì¥ë¶€</div></a>
      <a href="/admin/recommend_imDae/"><div class="text-lg font-extrabold px-2 py-1 rounded hover:bg-gray-200 cursor-pointer">ì„ëŒ€ì¶”ì²œ</div></a>
      <a href="/admin/recommend_maeMae/"><div class="text-lg font-extrabold px-2 py-1 rounded hover:bg-gray-200 cursor-pointer">ë§¤ë§¤ì¶”ì²œ</div></a>
      <a href="/admin/customer_manage/"><div class="text-lg font-extrabold px-2 py-1 rounded hover:bg-gray-200 cursor-pointer mb-5">ëª¨ë“ ê³ ê°</div></a>
      <a href="/admin/ad_censorship/"><div class="text-lg font-extrabold px-2 py-1 rounded hover:bg-gray-200 cursor-pointer">ê´‘ê³ ê´€ë¦¬</div></a>
      <a href="/admin/staff_manage/"><div class="text-lg font-extrabold px-2 py-1 rounded hover:bg-gray-200 cursor-pointer">ì§ì›ì •ë³´</div></a>
      <a href="/admin/performance/"><div class="text-lg font-extrabold px-2 py-1 rounded hover:bg-gray-200 cursor-pointer">ë§¤ì¶œ</div></a>
      <a href="/admin/cost_management/"><div class="text-lg font-extrabold px-2 py-1 rounded hover:bg-gray-200 cursor-pointer">ë¹„ìš©</div></a>
      <a id="settlement-tab" href="/admin/settlement/" style="display:none">
        <div class="text-lg font-extrabold px-2 py-1 rounded hover:bg-gray-200 cursor-pointer mb-5">ì •ì‚°</div>
      </a>
    </div>
    <div class="w-[94%] flex flex-col bg-gray-50">
      <div class="flex gap-4 items-start bg-gray-100"> <!-- í•„í„° ì˜ì—­ (ìƒë‹¨ 10%) -->
        <div class="flex flex-col w-[37%] mt-2">
          <div class="flex ml-[6.7rem] gap-3">
            <!-- ê³„ì •ì •ë³´ + ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
            <div id="account-info" class="flex items-center justify-between bg-gray-200 rounded px-3 py-2 mb-2 text-sm text-gray-700 gap-4">
              <div class="flex flex-row flex-wrap items-center gap-2 text-sm text-gray-700">
                <span id="account-affiliation" class="text-xs text-gray-600"></span>
                <span id="account-position" class="text-xs text-gray-600"></span>
                <span id="account-name" class="font-semibold"></span>
                <span id="account-extension" class="text-xs text-gray-600"></span>
                <span id="account-email" class="text-xs text-gray-600"></span>
              </div>
              <button id="logout-btn" class="text-xs text-red-600 hover:underline">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
            <button id="open-admin-listing-btn" class="hidden text-sm bg-blue-400 text-white rounded hover:bg-blue-600 rounded ml-auto px-3 py-1 leading-none h-[1.7rem]">ğŸ¢ ë§¤ë¬¼ë“±ë¡</button>  
            
            <div class="ml-auto">
              <button id="reset-filters-btn"
                      class="px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600">
                ì •ë ¬ ì´ˆê¸°í™”
              </button>
            </div>
          </div>      
          <div class="w-[100%] p-4 bg-gray-100 flex items-center gap-2 text-sm">
            <input type="text" id="id-input" placeholder="ë§¤ë¬¼ë²ˆí˜¸" class="border px-1.5 py-1 rounded w-[14%]" />
            <input type="text" id="title-input" placeholder="ë§¤ë¬¼ëª…" class="border px-1.5 py-1 rounded w-[27%]" />
            <input type="text" id="address-input" placeholder="ì£¼ì†Œ(ì½¤ë§ˆë¡œ ë³µìˆ˜ ì…ë ¥)" class="border px-1.5 py-1 rounded w-[26%]" />
            <input type="text" id="building-input" placeholder="ê±´ë¬¼ëª…" class="border px-1.5 py-1 rounded w-[22%]" />
            <button id="search-button" class="bg-blue-400 text-white px-3 py-1 rounded hover:bg-blue-600 w-[10%]">ê²€ìƒ‰</button>
          </div>
        </div>
        <!-- í•„í„° ì…ë ¥ì°½ ì˜ì—­ -->
        <div id="fixed-filter-box2" class="bg-gray-100 px-4 pt-2 pb-4">
          <!-- ì œëª©ì¤„ -->
          <div class="flex gap-4 font-semibold text-sm text-gray-700 mb-1">
            <div class="w-[4rem] text-center">ì¸µ</div>
            <div class="w-[6rem] text-center">ë³´ì¦ê¸ˆ</div>
            <div class="w-[5rem] text-center">ì›”ì„¸</div>
            <div class="w-[6rem] text-center">ê¶Œë¦¬ê¸ˆ</div>
            <div class="w-[4rem] text-center">ì „ìš©(í‰)</div>
            <div class="w-[6rem] text-center">ë§¤ë§¤ê°€</div>
            <div class="w-[4rem] text-center">ìˆ˜ìµë¥ </div>
          </div>

          <!-- ì´ìƒ ì…ë ¥ì°½ -->
          <div class="flex gap-4 mb-1">
            <input id="filter-floor-min"    type="number" placeholder="ì´ìƒ" class="border rounded px-2 py-1 w-[4rem]" />
            <input id="filter-deposit-min" type="number" placeholder="ì´ìƒ" class="border rounded px-2 py-1 w-[6rem]" />
            <input id="filter-rent-min" type="number" placeholder="ì´ìƒ" class="border rounded px-2 py-1 w-[5rem]" />
            <input id="filter-premium-min" type="number" placeholder="ì´ìƒ" class="border rounded px-2 py-1 w-[6rem]" />
            <input id="filter-area-min" type="number" placeholder="ì´ìƒ" class="border rounded px-2 py-1 w-[4rem]" />
            <input id="filter-sale-min" type="number" placeholder="ì´ìƒ" class="border rounded px-2 py-1 w-[6rem]" />
            <input id="filter-roi-min" type="number" placeholder="ì´ìƒ" class="border rounded px-2 py-1 w-[4rem]" />
          </div>

          <!-- ì´í•˜ ì…ë ¥ì°½ -->
          <div class="flex gap-4">
            <input id="filter-floor-max"    type="number" placeholder="ì´í•˜" class="border rounded px-2 py-1 w-[4rem]" />
            <input id="filter-deposit-max" type="number" placeholder="ì´í•˜" class="border rounded px-2 py-1 w-[6rem]" />
            <input id="filter-rent-max" type="number" placeholder="ì´í•˜" class="border rounded px-2 py-1 w-[5rem]" />
            <input id="filter-premium-max" type="number" placeholder="ì´í•˜" class="border rounded px-2 py-1 w-[6rem]" />
            <input id="filter-area-max" type="number" placeholder="ì´í•˜" class="border rounded px-2 py-1 w-[4rem]" />
            <input id="filter-sale-max" type="number" placeholder="ì´í•˜" class="border rounded px-2 py-1 w-[6rem]" />
            <input id="filter-roi-max" type="number" placeholder="ì´í•˜" class="border rounded px-2 py-1 w-[4rem]" />
          </div>
        </div>
          <!-- í•„í„° ì…ë ¥ì°½ ì˜ì—­ -->
          <div id="fixed-filter-box" class="h-[3.45rem] bg-gray-100 px-4 pt-2 pb-4 flex gap-7">
            <!-- ê±°ë˜ìœ í˜• -->
            <div>
              <div class="font-semibold mb-1">ê±°ë˜ìœ í˜•</div>
              <label class="block"><input type="checkbox" class="deal-type-checkbox" value="ì›”ì„¸" /> ì›”ì„¸</label>
              <label class="block"><input type="checkbox" class="deal-type-checkbox" value="ë§¤ë§¤" /> ë§¤ë§¤</label>
            </div>

            <!-- ê±°ë˜ì™„ë£Œ -->
            <div>
              <div class="font-semibold mb-1">ê±°ë˜ìƒíƒœ</div>
              <label class="block"><input type="checkbox" class="transaction-status-checkbox" value="ì§„í–‰ì¤‘" /> ì§„í–‰ì¤‘</label>
              <label class="block"><input type="checkbox" class="transaction-status-checkbox" value="ë³´ë¥˜" /> ë³´ë¥˜</label>
              <label class="block"><input type="checkbox" class="transaction-status-checkbox" value="ê³„ì•½ì™„ë£Œ" /> ê³„ì•½ì™„ë£Œ</label>
            </div>

            <!-- ëŒ€ë¶„ë¥˜ -->
            <div class="flex flex-col items-center">
              <div class="font-semibold mb-1">ëŒ€ë¶„ë¥˜</div>
              <div>
                <div class="flex gap-2">
                  <div>
                    <label class="block"><input type="checkbox" class="category-checkbox" value="ìƒê°€" /> ìƒê°€</label>
                    <label class="block"><input type="checkbox" class="category-checkbox" value="ë¹Œë”©" /> ë¹Œë”©</label>
                  </div>
                  <div>
                    <label class="block"><input type="checkbox" class="category-checkbox" value="ì£¼íƒ" /> ì£¼íƒ</label>
                    <label class="block"><input type="checkbox" class="category-checkbox" value="í† ì§€" /> í† ì§€</label>
                  </div>
                </div>
                <label class="block"><input type="checkbox" class="category-checkbox" value="ê³µì¥Â·ì°½ê³ " /> ê³µì¥Â·ì°½ê³ </label>
              </div>
            </div>
          </div>
      </div>
      <div class="px-4 bg-gray-100">
        <div class="px-4 py-4 bg-white border border-gray-300 rounded-md">
          <div id="table-container" class="h-[83vh] overflow-y-auto custom-scroll bg-whiteborderrounded-md">
            <table class="w-full table-fixed text-sm text-left bg-white">
              <thead class="bg-gray-100 sticky top-0 z-10">
                <tr id="header-row">
                  <th class="p-1 border-r text-sm text-center w-[4.54rem]">ë§¤ë¬¼ë²ˆí˜¸</th>
                  <th class="p-1 border-r text-sm text-center w-[5rem]">ìƒíƒœ</th>
                  <th class="resizable p-2 border-r text-sm text-center w-[16rem]">ë§¤ë¬¼ëª…<div class="resize-handle"></div></th>
                  <th class="p-1 border-r text-sm text-center w-[10.5rem]">ì£¼ì†Œ</th>
                  <th class="p-1 border-r text-sm text-center w-[9rem]">ê±´ë¬¼ì •ë³´</th>
                  <th class="p-1 border-r text-sm text-center">í˜¸ìˆ˜</th>
                  <th class="p-1 border-r text-sm text-center w-[4rem]">ì¸µ</th>
                  <th class="p-1 border-r text-sm text-center">ë³´ì¦ê¸ˆ</th>
                  <th class="p-1 border-r text-sm text-center">ì›”ì„¸</th>
                  <th class="p-1 border-r text-sm text-center">ê¶Œë¦¬ê¸ˆ</th>
                  <th class="p-1 border-r text-sm text-center min-w-[4.5rem]">ì „ìš©(í‰)</th>
                  <th class="p-1 border-r text-sm text-center w-[6.5rem]">ê³µê¸‰/ì „ìš©(ã¡)</th>
                  <th class="p-1 border-r text-sm text-center">ë§¤ë§¤ê°€</th>
                  <th class="p-1 border-r text-sm text-center min-w-[1rem]">ì´ë³´ì¦ê¸ˆ</th>
                  <th class="p-1 border-r text-sm text-center">ì´ì›”ì„¸</th>
                  <th class="p-1 border-r text-sm text-center">ìˆ˜ìµë¥ </th>
                  <th class="p-1 border-r text-sm text-center">ìƒê°€íƒ€ì…</th>
                </tr>
              </thead>
              <tbody id="listings-body" class="bg-white"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
