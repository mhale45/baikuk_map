<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>로그인 페이지</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 2rem;
        }
        input {
            padding: 0.5rem;
            margin: 0.5rem 0;
            width: 200px;
        }
        button {
            padding: 0.5rem 1rem;
            background-color: #3b82f6;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #2563eb;
        }
    </style>
</head>
<body>

    <h1>로그인</h1>

    <input type="email" id="email" placeholder="이메일"><br>
    <input type="password" id="password" placeholder="비밀번호"><br>
    <button onclick="login()">로그인</button>

    <script>
        const supabaseUrl = "https://YOUR_PROJECT.supabase.co";  // ← 본인의 Supabase URL
        const supabaseKey = "YOUR_PUBLIC_ANON_KEY";              // ← 본인의 공개 키
        const client = supabase.createClient(supabaseUrl, supabaseKey);

        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            const { data, error } = await client.auth.signInWithPassword({
                email,
                password
            });

            if (error) {
                alert("❌ 로그인 실패: " + error.message);
                return;
            }

            console.log("✅ 로그인 성공, 세션 적용 대기 중...");
            checkSessionAndRedirect();
        }

        // ✅ 세션이 확실히 적용됐을 때만 admin.html로 이동
        async function checkSessionAndRedirect() {
            for (let i = 0; i < 10; i++) {
                const { data } = await client.auth.getSession();
                if (data.session) {
                    console.log("✅ 세션 확인됨 → admin.html 이동");
                    window.location.replace('admin.html');
                    return;
                }
                await new Promise(res => setTimeout(res, 300)); // 0.3초 대기
            }
            alert("세션을 불러오지 못했습니다. 다시 시도해 주세요.");
        }
    </script>

</body>
</html>
